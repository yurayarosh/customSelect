"use strict";function offset(t){var e=t.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}function wrap(t,e){t.parentNode.insertBefore(e,t),e.appendChild(t)}function unwrap(t){for(var e=document.createDocumentFragment();t.firstChild;){var s=t.removeChild(t.firstChild);e.appendChild(s)}t.parentNode.replaceChild(e,t)}function detectTouch(){return"ontouchstart"in window||navigator.maxTouchPoints}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var s=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var o=Object.keys(Object(i)),l=0,a=o.length;l<a;l++){var c=o[l],r=Object.getOwnPropertyDescriptor(i,c);void 0!==r&&r.enumerable&&(s[c]=i[c])}}return s}}),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;if(t&&"string"==typeof t){for(var s=t.charAt(0);e&&e!==document;e=e.parentNode){if("."===s&&e.classList&&e.classList.contains(t.substr(1)))return e;if("#"===s&&e.id===t.substr(1))return e;if("["===s&&e.hasAttribute(t.substr(1,t.length-2)))return e;if(e.tagName.toLowerCase()===t)return e}return!1}});var classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function n(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,s){return e&&n(t.prototype,e),s&&n(t,s),t}}(),Select=function(){function s(t,e){classCallCheck(this,s),this.el=t,this.defaultParams={optionBuilder:!1,panelItem:!1,changeOpenerText:!0,multipleSelectionOnSingleClick:!1,multipleSelectOpenerText:!1,allowPanelClick:!1,openOnHover:!1,closeOnMouseleave:!1},e=Object.assign({},this.defaultParams,e),this.options={optionBuilder:e.optionBuilder,panelItem:e.panelItem,changeOpenerText:e.changeOpenerText,multipleSelectionOnSingleClick:e.multipleSelectionOnSingleClick,multipleSelectOpenerText:e.multipleSelectOpenerText,allowPanelClick:e.allowPanelClick,openOnHover:e.openOnHover,closeOnMouseleave:e.closeOnMouseleave},this.constants={wrap:"custom-select",opener:"custom-select__opener",panel:"custom-select__panel",option:"custom-select__option",optionsWrap:"custom-select__options",optgroup:"custom-select__optgroup",panelItemClassName:"custom-select__panel-item",IS_OPEN:"is-open",IS_DISABLED:"is-disabled",IS_MULTIPLE:"is-multiple",IS_SELECTED:"is-selected",IS_ABOVE:"is-above",HAS_CUSTOM_SELECT:"has-custom-select",DATA_ALLOW_PANEL_CLICK:"data-allow-panel-click",DATA_LABEL:"data-label",DATA_VALUE:"data-value",DATA_HAS_PANEL_ITEM:"data-has-panel-item"},this.isTouch=detectTouch()}return createClass(s,[{key:"init",value:function(){this._createElements(),this._open(),this._close(),this._change()}},{key:"destroy",value:function(){this._destroy()}},{key:"refresh",value:function(){this.destroy(),this.init()}},{key:"select",value:function(){return this.el.parentNode}},{key:"opener",value:function(){return this.select().querySelector("."+this.constants.opener)}},{key:"panel",value:function(){return this.select().querySelector("."+this.constants.panel)}},{key:"addOptionItem",value:function(t,e){this.options.optionBuilder&&this.options.optionBuilder(t,e)}},{key:"openSelect",value:function(t){if(!this.el.disabled){var e=document.querySelectorAll("."+this.constants.wrap+"."+this.constants.IS_OPEN);this.select().classList.toggle(this.constants.IS_OPEN);for(var s=0;s<e.length;s++)e[s].classList.remove(this.constants.IS_OPEN);this.setPanelPosition(),this.onOpen&&this.select().classList.contains(this.constants.IS_OPEN)?this.onOpen(this.el):this.onClose&&this.onClose(this.el)}}},{key:"closeSelect",value:function(t){var e=document.querySelectorAll("."+this.constants.wrap+"."+this.constants.IS_OPEN);if(e.length&&!t.target.closest("."+this.constants.IS_DISABLED)&&!t.target.hasAttribute(this.constants.DATA_LABEL)){if(t.target.closest("."+this.constants.wrap)){var s=t.target.closest("."+this.constants.wrap).querySelector("select");if(s.multiple&&o(t,this.constants.panel))return;if(s.hasAttribute(this.constants.DATA_ALLOW_PANEL_CLICK)&&o(t,this.constants.panel))return;if(s.hasAttribute(this.constants.DATA_HAS_PANEL_ITEM)&&o(t,this.constants.panelItemClassName))return}if(-1===t.target.className.indexOf(this.constants.opener))for(var n=0;n<e.length;n++)e[n].classList.remove(this.constants.IS_OPEN);if(this.onClose&&t.target.className.indexOf(this.constants.opener)){var i=e[0].querySelector("select");if(1<e.length)return void console.warn("`onClose()` function does not have an argument due to several selects are open.");this.onClose(i)}}function o(t,e){if(t.target.classList&&t.target.classList.contains(e)||t.target.closest("."+e))return!0}}},{key:"setSelectedOptionsMultiple",value:function(t){var e=t.clickedCustomOption,s=t.nativeOptionsList,n=t.item;s[n].selected?(s[n].selected=!1,e.classList.remove(this.constants.IS_SELECTED)):(s[n].selected=!0,e.classList.add(this.constants.IS_SELECTED))}},{key:"setSelectedOptionsDefault",value:function(t){for(var e=t.clickedCustomOption,s=t.nativeOptionsList,n=t.customOptionsList,i=t.item,o=0;o<s.length;o++)s[o].selected=!1,n[o].classList.remove(this.constants.IS_SELECTED);e.classList.add(this.constants.IS_SELECTED),s[i].selected=!0}},{key:"setSelectedOptions",value:function(t){var e=t.e,s=t.clickedCustomOption,n=t.nativeOptionsList,i=t.customOptionsList,o=t.item;this.el.multiple&&(this.options.multipleSelectionOnSingleClick||e.ctrlKey)?this.setSelectedOptionsMultiple({clickedCustomOption:s,nativeOptionsList:n,item:o}):this.setSelectedOptionsDefault({clickedCustomOption:s,nativeOptionsList:n,customOptionsList:i,item:o})}},{key:"setPanelPosition",value:function(){offset(this.panel()).top+this.panel().offsetHeight>=window.innerHeight?this.panel().classList.add(this.constants.IS_ABOVE):this.panel().classList.remove(this.constants.IS_ABOVE)}},{key:"getSelectOptionsText",value:function(t){for(var e=t&&t.options,s=[],n=void 0,i=0;i<e.length;i++)(n=e[i]).selected&&s.push(n.text);return s.join(", ")}},{key:"addDataAttributes",value:function(t,e){var s=[].filter.call(t.attributes,function(t){return/^data-/.test(t.name)});s.length&&s.forEach(function(t){e.setAttribute(t.name,t.value)})}},{key:"_createElements",value:function(){var s=document.createElement("div"),t=document.createElement("div"),e=document.createElement("div"),n=this.el.options,i=this.el.querySelectorAll("optgroup"),o=void 0,l=void 0;if(this.options.panelItem.item&&((l=document.createElement("div")).className=this.constants.optionsWrap,this.el.setAttribute(this.constants.DATA_HAS_PANEL_ITEM,""),(o=this.options.panelItem.item.cloneNode(!0)).classList.add(this.constants.panelItemClassName)),"top"===this.options.panelItem.position&&t.appendChild(o),0<i.length){for(var a=0;a<i.length;a++){for(var c=i[a].label,r=i[a].querySelectorAll("option"),u=document.createElement("div"),p=0;p<r.length;p++){var d=document.createElement("div");d.classList.add(this.constants.option),d.setAttribute(this.constants.DATA_VALUE,r[p].value),d.innerHTML=r[p].innerHTML,this.addDataAttributes(r[p],d),r[p].selected&&(d.classList.add(this.constants.IS_SELECTED),e.innerHTML=r[p].innerHTML),r[p].disabled&&d.classList.add(this.constants.IS_DISABLED),this.addOptionItem(r[p],d),u.appendChild(d)}u.classList.add(this.constants.optgroup),u.setAttribute(this.constants.DATA_LABEL,c),this.addDataAttributes(i[a],u),l?l.appendChild(u):t.appendChild(u)}l&&t.appendChild(l)}else{for(var h=0;h<n.length;h++){var m=document.createElement("div");m.classList.add(this.constants.option),m.innerHTML=n[h].innerHTML,m.setAttribute(this.constants.DATA_VALUE,n[h].value),this.addDataAttributes(n[h],m),n[h].selected&&(m.classList.add(this.constants.IS_SELECTED),e.innerHTML=n[h].innerHTML),n[h].disabled&&m.classList.add(this.constants.IS_DISABLED),this.addOptionItem(n[h],m),l?l.appendChild(m):t.appendChild(m)}l&&t.appendChild(l)}function v(t,e){t&&s.classList.add(e)}"bottom"===this.options.panelItem.position&&t.appendChild(o),this.options.allowPanelClick&&this.el.setAttribute(this.constants.DATA_ALLOW_PANEL_CLICK,""),s.classList.add(this.constants.wrap),v(this.el.disabled,this.constants.IS_DISABLED),v(this.el.multiple,this.constants.IS_MULTIPLE),t.classList.add(this.constants.panel),e.classList.add(this.constants.opener),wrap(this.el,s),s.appendChild(e),s.appendChild(t)}},{key:"_open",value:function(){var t=this.options.openOnHover&&!this.isTouch?"mouseenter":"click";this.openSelectBind=this.openSelect.bind(this),this.opener().addEventListener(t,this.openSelectBind)}},{key:"_close",value:function(){this.options.closeOnMouseleave&&!this.isTouch&&this.select().addEventListener("mouseleave",function(t){document.body.click()}),document.documentElement.classList.contains(this.constants.HAS_CUSTOM_SELECT)||(this.closeSelectBind=this.closeSelect.bind(this),document.addEventListener("click",this.closeSelectBind),document.documentElement.classList.add(this.constants.HAS_CUSTOM_SELECT))}},{key:"_change",value:function(){for(var i=this,o=this.el.options,l=this.select().querySelectorAll("."+this.constants.option),t=function(n){l[n].addEventListener("click",function(t){if(!i.el.disabled){var e=t.currentTarget;if(!e.classList.contains(i.constants.IS_DISABLED)){i.setSelectedOptions({e:t,clickedCustomOption:e,nativeOptionsList:o,customOptionsList:l,item:n});var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),i.el.dispatchEvent(s),i.options.changeOpenerText&&(i.el.multiple&&i.options.multipleSelectOpenerText?i.getSelectOptionsText(i.el)&&(i.opener().innerText=i.getSelectOptionsText(i.el)):i.el.multiple&&!i.options.multipleSelectOpenerText?i.opener().innerHTML=i.opener().innerHTML:i.opener().innerHTML=e.innerText)}}})},e=0;e<l.length;e++)t(e)}},{key:"_destroy",value:function(){document.removeEventListener("click",this.closeSelectBind),document.documentElement.classList.remove(this.constants.HAS_CUSTOM_SELECT),this.panel()&&this.opener()&&(this.opener().parentNode.removeChild(this.opener()),this.panel().parentNode.removeChild(this.panel()),unwrap(this.select()))}}]),s}();module.exports=Select;
